#!/bin/sh
#	$Id$
# Pia launcher.  Also handles other classes in the PIA hierarchy.
#	Always tacks on -p propertyFile, which may be a misfeature.
#
# Usage: 
#	pia_wrapper [-v] [class [arg]... ]

if [ "$1" = "-v" ] ; then
    VERBOSE=1
    shift
fi

#find out where java is, ya
PRG=`which java` >/dev/null 2>&1
#J_HOME=`dirname $PRG`/..
J_HOME=`dirname $PRG`/..

if [ -z "$JAVA_HOME" ] ; then
    export JAVA_HOME
    JAVA_HOME=$J_HOME
fi

#where zjava lives, ya
JAVA_BIN=$JAVA_HOME/bin/java
export JAVA_BIN

#where pia lives, ya
PIA_HOME="${PIA_HOME-$HOME/pia}"
export PIA_HOME

if [ -f $PIA_HOME/lib/java/crc.zip ] ; then
    PIA_CLASSES=${PIA_CLASSES-$PIA_HOME/lib/java/crc.zip}
else
    PIA_CLASSES=$PIA_HOME/src/java
fi

#where zjigsaw lives, ya
if [ -f $PIA_HOME/lib/java/jigsaw.zip ] ; then
    JIGSAW_HOME=${JIGSAW_HOME-$PIA_HOME/lib/java}
else
    JIGSAW_HOME="${JIGSAW_HOME-usr/local/Jigsaw}"
fi
export JIGSAW_HOME

if [ -f $PIA_HOME/lib/java/jigsaw.zip ] ; then
    JIGSAW_CLASSES=${JIGSAW_CLASSES-$PIA_HOME/lib/java/jigsaw.zip}
else
    JIGSAW_CLASSES=$JIGSAW_HOME/src/classes
fi

if [ -z "$1" ] ; then
    PIA_BIN=crc.pia.Pia
elif [ "$1" = "--" ] ; then
    PIA_BIN=crc.pia.Pia
    shift
else
    PIA_BIN=$1
    shift
fi

if [ -f $home/.pia/pia.props ] ; then
    # This suggests that a Config agent may eventually exist:
    PIA_CONFIGFILE=$HOME/.pia/Config/pia.props
else
    PIA_CONFIGFILE=$HOME/pia/Config/pia.props
fi

CLASSPATH="${CLASSPATH-.}"
if [ -z "${CLASSPATH}" ] ; then
    CLASSPATH="$J_HOME/classes:$J_HOME/lib/classes.zip:$JIGSAW_CLASSES:$PIA_CLASSES"
else
    CLASSPATH="$CLASSPATH:$J_HOME/classes:$J_HOME/lib/classes.zip:$JIGSAW_CLASSES:$PIA_CLASSES"
fi
export CLASSPATH

[ -z "$VERBOSE" ] || echo $CLASSPATH
[ -z "$VERBOSE" ] || echo "$JAVA_BIN $PIA_BIN -p $PIA_CONFIGFILE $*"
exec $JAVA_BIN $PIA_BIN -p $PIA_CONFIGFILE $*

