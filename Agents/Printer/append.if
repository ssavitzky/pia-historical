<!doctype html public "-//IETF//DTD HTML//EN//2.0">
<html><head>
<title>  &agentName; preview</title>
<link rev="made" href="mailto:wolff@crc.ricoh.com">
</head><body bgcolor="#ffffff" link="#c40026" vlink="#e40026">
<set entity name=title> &agentName;  PreviewPage</set>
<read interform file="heading.inc" process>

<tagset-load name=Printer-agent-actors>


<if><test><get form name="spoolfile"></test>
  <then>
    <set name="spoolfile"><get form name=spoolfile></set>
    <set name="theurl"><get name=URL form></set>
    <set name="thestyle"><get name=style form></set>

    <set name="anchors"><read file="&spoolfile;.links" process></set>
<set name="anchors"><get index="anchors.anchors"></set>

<form action="&url;" method="post" process copy>
 <process copy>
<set name="docbody"><body> </body></set>
<repeat list="&anchors;">
<set name="link"><get name="li" attr=linkid></set>
<if><get name="link&link;" form>
 <then> 
    <set name="aurl"><get name=li attr=href></set>
    <fetch-url input=&aurl; base=&theurl; style=&thisstyle;
    output=&spoolfile;.link&linkid;>
    <set name=linktoc insert=-1><dt><get index=l.Text></dt><dd><get name=aurl></dd></set>
    <set name="linkbody"><get index="document.html.body"></set>
<if><get name="linkbody">
 <else><set name="linkbody"><get name="document" findall=body></set> </else></if>
<if><get name="linkbody">
 <else><set name="linkbody"><get name="document"></set> </else></if>

 <set name="docbody" insert=-1> <br> <h1 rev=TOC><get name=l></h1> <h5>URL:
 <get name=aurl></h5>
  <get name=linkbody>
  </set>

</then> 
</if> 
</repeat>

  <set name=spoolfile><new-file-name></set>
<set name="document"><html><head><title>Links from &theurl; </title>
</head> 
<get name="docbody">
</html></set>
<write file=&spoolfile;.html><get name="document"></write>

<cache-entry url=&theurl; style=&thisstyle; output=&spoolfile;>


    <create-ps-file-simple file=&spoolfile;.html input=&theurl;
    output=&spoolfile; style=&thisstyle;>

<!--    creating Previews ... ps file command returned: &commandout; --> 
     <create-ps-preview-simple style=&thisstyle; psfile=&spoolfile;>

<!-- Preview command returned: &commandout; -->

     <show-summary spoolfile=&spoolfile; parseddoc=&document;
     url=&theurl; book=true>
     </show-summary>


 </process>
<repeat list="&anchors;">
<set name="link"><get name="li" attr=linkid></set>
 <input type="checkbox" name=link&link; ><get name="li">
</repeat>
 <input type="submit" value="retrieve/preview links">
</form>
   </then>


  </if>

<print-bar spoolfile=&spoolfile; url=&theurl; style=&thisstyle;>

</then>
<else>
no document identified


</else>
</if>

<page-footer> </page-footer>
</body></html>
