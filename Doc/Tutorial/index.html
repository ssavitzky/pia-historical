<!doctype html public "-//IETF//DTD HTML//EN//2.0">
<html><head>
<title>PIA Short-Course Syllabus</title>
<link rev="made" href="mailto:wolff@rsv.ricoh.com">
</head><body>

<H1>
PIA Tutorial contents</H1>

<H2>
<A HREF="#basics">The Basics</A></H2>

<OL>
<LI>
<A HREF="#running">Running a Personal Information Agency</A></LI>

<LI>
<A HREF="#viewing">Viewing an agents home page</A></LI>

<LI>
<A HREF="#using">Using the history agent</A></LI>

<LI>
<A HREF="#directories">Directory structure</A></LI>
</OL>

<H2>
<A HREF="#agents">Agents &amp; InterForms</A></H2>

<OL>
<LI>
<A HREF="#InterForms">Customizing an agent</A> (Introduction to InterForms)</LI>

<LI>
<A HREF="#creating">Creating a new agent -- "Hello World!"</A></LI>

<LI>
<A HREF="#advanced">Advanced topics</A></LI>
</OL>

<H2>
<A NAME="basics"></A>The Basics</H2>

<H3>
<A NAME="running"></A>Running a Personal Information Agency</H3>
<A HREF="#viewing">(Skip to the next section if you already have an agency
running.)</A>

<P>&nbsp;An&nbsp;<it>Information Agency</it> is a software program written
in Java. To run it, you need access to a Java "runtime" (e.g. "java" should
be located in one of the directories on your <TT>PATH</TT> -- usually either
<TT>/usr/local/java/bin</TT>, as it is on the Suns at CRC, or <TT>/usr/java/bin</TT>,
as it is on most Linux systems) and a PIA home directory (you can either
use <TT>/pia1/pia</TT> or <A HREF="http://jaguar.crc.ricoh.com:8888/PIA/INSTALL">install
</A>your own).

<P>To run the pia, execute the command <TT>PIA_DIR/bin/pia</TT>, where
<TT>PIA_DIR</TT> is the PIA home directory. Sun users at CRC can simply
type <TT>jpia</TT> (<TT>/usr/local/bin/jpia</TT> is a shell wrapper which
executes <TT>pia</TT> using <TT>/pia1/pia</TT> as the PIA directory).
<H4>
If you are a developer</H4>
you probably have a working copy of the PIA's source tree checked out in
your home directory. In that case, <TT>PIA_DIR</TT> is <TT>~/pia</TT> --
the <TT>pia</TT> subdirectory of your home directory. You should start
the PIA with the command:
<PRE>&nbsp; ~/pia/bin/pia</PRE>
If you use <TT>jpia</TT>, any changes you make in the code won't be reflected
on the server, and you'll wonder why nothing changed.
<H4>
Once it's Running</H4>
Once you have an agency running, you should be able to view your agency's
home page at <TT><A HREF="http://localhost:8888/">http://<I>YOUR.HOST.NAME.HERE</I>:8888/</A>
</TT>using any browser.

<P>If you have trouble getting to this point, please contact the <A HREF="http://jaguar.crc.ricoh.com:8888/PIA/Doc/pia_group.html">PIA
group </A>.
<H3>
<A NAME="viewing"></A>Viewing an agents home page</H3>
We call our system an Information Agency because every document (or request
for a document) is processed by one or more agents. Agents are software
<B>objects with an attitude </B>. Typically, they perform some specific
task <I>on your behalf</I> (which is why they're called <I>agents</I>)
while maintaining state and context information. (This state maintenance
along with the Agency framework allows agents to be more flexible, and
much easier to generate and maintain than traditional web processes such
as CGI scripts.)

<P>If you have not already done so, please open another browser window
on your <A HREF="http://localhost:8888/Agency/ROOT/index">agency's home
page</A>.

<P>Notice the url for this page:
<PRE>http://localhost:8888/Agency/ROOT/index
^^^^^^^^^^^^^^^^^^^^^ ^^^^^^ ^^^^^^^^^^
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3</PRE>
It consists of three parts
<OL>
<LI>
<TT>http://.../</TT> -- the machine name and port number</LI>

<LI>
<TT>Agency</TT> -- the name of the agent handling this request</LI>

<LI>
<TT>ROOT/index</TT> -- a path from that agent's root directory.</LI>
</OL>
This url denotes a request to the <TT>Agency</TT> agent (part 2) running
on your local Information Agency (part 1). The <TT>Agency</TT> agent is
sort of the mother of all agents. It is the agent responsible for installing,
removing, and listing other agents -- along with some miscellaneous things
like <A HREF="http://jaguar.crc.ricoh.com:8888/Agency/bug.if">reporting
bugs</A>.

<P>The third part, <TT>ROOT/index.xh,</TT> indicates the InterForm -- an
html file with some special tags -- that the agent processed in order to
generate the page that your browser displays.

<P>On this page, you should see a listing of all the agents currently running
on your Information Agency. Click on one of the agent links to see the
home page for that agent. By default, the agency comes configured to start
up with the following agents:
<DL>
<DT>
<TT>Agency</TT></DT>

<DD>
main agent-- manages all other agents</DD>

<DT>
<TT>History</TT></DT>

<DD>
maintains list of visited web pages -- see below</DD>

<DT>
<TT>fbi</TT></DT>

<DD>
adds control menu to pages served by your Information Agency</DD>

<DT>
<TT>cia</TT></DT>

<DD>
adds control menu to pages proxied through your agency</DD>

<DT>
<TT>PIA</TT></DT>

<DD>
serves files located in the PIA_DIR directory</DD>

<DT>
<TT>My</TT></DT>

<DD>
serves files located in your local PIA_HOME directory (usually <TT>~/.pia</TT>
)</DD>
</DL>

<H3>
<A NAME="using"></A>Using the history agent</H3>
The History agent is meant to keep track of all web pages that you visit
from any browser, allowing you to search those urls by date or other feature.
To make best use of the History agent, you should set your browsers to
use your local Information Agency as your proxy (this setting is usually
found under the Network options available under edit/preferences, options/network,
or some similar menu. You need to specify both the host name and port--8888
by default-- where your agency is running.)

<P>Once you set your Information Agency as your proxy, browse to a few
external web pages, then visit the <A HREF="http://jaguar.crc.ricoh.com:8888/History/home.if">History
agent's home page</A>. You should see a link to today's date (e.g. <TT>My/History
/ 1997 / 08 / 04</TT>) which will list the pages you visited.
<H3>
<A NAME="directories"></A>Directory structure</H3>
In addition to the PIA_DIR directory (which contains all the code, documentation,
agents, etc. released by the PIA group), your information agency also uses
PIA_HOME (typically <TT>~/.pia</TT>) to store agent data and customized
interforms. By default, agents will read and write their data files into
PIA_HOME/AGENT_NAME (where AGENT_NAME is the name of the agent. So, by
default the History agent keeps lists of visited urls in <TT>~/.pia/History/</TT>)

<P>For their InterForms, agents look first in PIA_HOME/Agents/AGENT_NAME,
and then in PIA_DIR/Agents/AGENT_NAME making it easy to customize your
agents simply by putting new InterForm files in PIA_HOME/Agents/AGENT_NAME/FILENAME.xh
(so a customized form, <TT>foo.xh</TT> for the History agent would go in
<TT>~/.pia/Agents/History/foo.xh</TT>).
<H2>
<A NAME="agents"></A>Agents &amp; InterForms</H2>
Agents are persistent software objects running on the Information Agency.
When they receive a request for a document, they look for a file (in PIA_xxxx/Agents/AGENT_NAME)
which matches that request. Once the file is found, they interpret that
file and return the result. To the end user, these files provide a <I>form</I>-based
<I>interface</I> for interacting with the agent, hence they are called
InterForms (with <TT>.xh</TT> as the conventional extension. The older
<TT>.if</TT> extension is still valid, but will eventually be phased out.)
In addition to standard HTML tags, InterForms can include several additional
tags or entities which the agent understands and processes. So, for example,
if an InterForm for the History agent includes the text: <TT>&amp;agentName;</TT>
(the &amp;xxx; denotes an "entity") the agent will substitute it's name
for this entity, so in the browser the user would see <TT>History</TT>.

<P>For more examples, see the <A HREF="http://jaguar.crc.ricoh.com:8888/InterForm">InterForm</A>
demo agent and the <A HREF="http://jaguar.crc.ricoh.com:8888/PIA/Doc/Manuals/InterForm/index.html">InterForm
Manual</A>.
<H3>
<A NAME="InterForms"></A>Customizing an agent</H3>
To add new function to the History agent, create a file, <TT>~/.pia/Agents/History/today.if</TT>
(assuming that PIA_HOME=~/.pia) with the following contents:
<BR><TT>&lt;html>&lt;body></TT>
<BR><TT>&lt;h2> Web pages visited Today&lt;/h2></TT>
<BR><TT>&lt;read file="&amp;year;/&amp;month;/&amp;day;.html"></TT>
<BR><TT>&lt;/body>&lt;/html></TT>

<P>Save that file (today.if) and then use your browser to view the url
<A HREF="http://jaguar.crc.ricoh.com:8888/History/today.if">/History/today.if</A>
If you have been using your agency as a proxy to view external documents,
you should get a listing of all places you visited today.
<H4>
What's going on?</H4>
The History agent stores urls in files organized by date. The file <TT>~/.pia/History/1997/07/11.html</TT>
stores all the urls visited on July 11, 1997. Using the pre-defined entities
in the Interform language, the file for today's date (relative to the History
data directory) can be written as <TT>&amp;year;/&amp;month;/&amp;day;.html</TT>.
The <TT>&lt;read file="FILENAME"> </TT>tells the History agent to read
the specified file and insert the contents at this location. (If the file
does not exist, nothing gets inserted.)
<H3>
<A NAME="creating"></A>Creating a new agent -- "HelloWorld"</H3>


<P>To create your own agent, first create a directory, <TT>~/.pia/Agents/HelloWorld</TT>.
Now create a home page for your agent, <TT>~/.pia/Agents/HelloWorld/home.xh</TT>
with something like the following content:
<BR><TT>&lt;html> &lt;body></TT>
<BR><TT>&lt;h2> I am the &amp;agentName; agent &lt;/h2></TT>
<BR><TT>My owner is &amp;piaUSER;.</TT>
<BR><TT>&lt;if>&lt;get form name=data>&lt;then></TT>
<BR><TT>You asked &lt;get form name=data></TT>
<BR><TT>to which I have no answer yet.</TT>
<BR><TT>&lt;/then>&lt;else></TT>
<BR><TT>&lt;form action="&amp;urlPath;" method="post"></TT>
<BR><TT>&lt;input type="submit" value="AskMe"></TT>
<BR><TT>A Question: &lt;input name="data"></TT>
<BR><TT>&lt;/form></TT>
<BR><TT>&lt;/else></TT>
<BR><TT>&lt;/if></TT>
<BR><TT>&lt;/body>&lt;/html></TT>

<P>Now install your agent using the <A HREF="http://jaguar.crc.ricoh.com:8888/Agency/install_agent.if">/Agency/install_agent.if</A>
InterForm. (Go to that page, enter <TT>HelloWorld</TT> as the name of your
agent and click on the install button.)

<P>You should now the able to see and interact with your <A HREF="http://jaguar.crc.ricoh.com:8888/HelloWorld/home.xh">HelloWorld
agent</A>.
<H4>
What's going on?</H4>
Most of the above <TT>home.xh</TT> is just standard html (for which plenty
of references are available <A HREF="http://www.yahoo.com/Computers_and_Internet/Internet/World_Wide_Web/Information_and_Documentation/Beginner_s_Guides/Beginner_s_HTML/">on
the net</A>). The InterForm extensions are explained below:
<TABLE>
<TR>
<TH>InterForm&nbsp;</TH>

<TH>Explanation&nbsp;</TH>
</TR>

<TR>
<TD>&amp;agentName;&nbsp;</TD>

<TD>entity (like a variable) specifying current agent's name&nbsp;</TD>
</TR>

<TR>
<TD>&amp;piaUSER;&nbsp;</TD>

<TD>entity specifying user id agency is running under&nbsp;</TD>
</TR>

<TR>
<TD>&lt;if>&lt;get form name=data>&lt;then>&nbsp;</TD>

<TD><TT>if</TT> the request for this document included a non-empty form
input field named <TT>data</TT>, <TT>then</TT> do the following.&nbsp;</TD>
</TR>

<TR>
<TD>&lt;get form name=data>&nbsp;</TD>

<TD>specifies the value (if any) of the <TT>data </TT>field of the form
submitted as part of the request for this document. (The <TT>get</TT> tag
is another way to look up variables. &lt;get form name=data>&lt; is synonymous
with &amp;FORM.data;)&nbsp;</TD>
</TR>

<TR>
<TD>&lt;/then>&lt;else>&nbsp;</TD>

<TD>end of <TT>then</TT> tag, start of <TT>else</TT> tag (contents interpreted
only if the <TT>data</TT> does not exist).&nbsp;</TD>
</TR>

<TR>
<TD>action="&amp;urlPath;"&nbsp;</TD>

<TD>specifies that this form should be submitted to the same url as the
current document&nbsp;</TD>
</TR>

<TR>
<TD>&lt;/else> &lt;/if>&nbsp;</TD>

<TD>end of <TT>else</TT> and <TT>if</TT> tags&nbsp;</TD>
</TR>
</TABLE>
Basically, what this InterForm does is check to see if the user submitted
a form. If so, the form data is processed and the results displayed, otherwise
the form is presented for the user to fill out.

<H3>
Creating a More Advanced Agent</H3>
Swifty is an example of a simple agent that may be used to create a home
page. Like most home pages, the one produced by Swifty contains a set of the
most commonly-used URLs. Many other categories of information could be
added, but as this is a tutorial, we wanted to keep it simple. What Swifty
does, is present you with a home page that has an edit button so that you
can change the page to a certain extent. There are two different types
of edits: you can enter a string that will be included in the home page
title; or you can select from among a number of buttons to indicate which
URLs you would like to include on your home page. 
<p>
The two pages presented
by Swifty are: <A HREF="/Swifty/home.xh">home.xh</A>, which is the current version of the home page,
and <A HREF="/Swifty/edit_page.xh">edit_page.xh</A>, which provides some editing capabilities. Both agent
pages are given a <A HREF="/PIA/Doc/Manuals/InterForm/index.html#file_ext">
.xh</A> extension, to indicate that they are extended-html
documents. Extended html means that you can use pre-defined 
<A HREF="/PIA/Doc/Manuals/InterForm/index.html#tagsets">PIA tags</A>, or
create your own tags. These tags are interpreted and processed by the PIA
interpreter. The bulk of the code in these files is standard html; however,
this tutorial concentrates on explaining the PIA tags. A third file associated
with this agent, <A HREF="/Swifty/Swifty-xhtml.ts">Swifty-xhtml.ts</A>, 
contains some additional tags that are used to process user edits.
<H4>
Creating the Agent Home Page</H4>
Each agent has a home.xh page. This is the page that comes up when the
agent is selected from the Agency's list of running agents. Even though
Swifty is in the business of producing home pages, all agents will have
home.xh, regardless of what they do. Listed below is Swifty's home.xh,
followed by an explanation of all PIA tags.
<PRE>

&lt;!doctype html public "-//IETF//DTD HTML//EN//2.0"&gt;&lt;HTML&gt;
&lt;html&gt;&lt;head&gt;
&lt;body bgcolor="#ffffff" link="#c40026" vlink="#e40026"&gt;
&lt;title&gt;Prototype Home Page&lt;/title&gt;
&lt;a name="Swifty Home"&gt;&lt;/a&gt;
&lt;header&gt;
&lt;/head&gt;

&lt;form action="/Swifty/edit_page" method="POST"&gt;

&lt;!-- =================================================================== --&gt;
&lt;!-- Put in a default name in the heading
&lt;!-- =================================================================== --&gt;

&lt;h1&gt;&lt;font color="#FF0000"&gt; Home Page for &AGENT:fname; &lt;/font&gt;&lt;/h1&gt;

&lt;!-- =================================================================== --&gt;
&lt;!-- Use a table to layout an image column and a links column
&lt;!-- =================================================================== --&gt;

&lt;TABLE BORDER=0 CELLSPACING=5 CELLPADDING=2 COLS=2 WIDTH="66%" HEIGHT="33%" NOSAVE &gt;
&lt;TR&gt;
&lt;!-- Add column headers --&gt;
&lt;TD&gt;&lt;b&gt;&lt;u&gt;&lt;font size=+2&gt;Photo Album&lt;/font&gt;&lt;/u&gt;&lt;/b&gt;&lt;/TD&gt;
&lt;TD&gt;&lt;b&gt;&lt;u&gt;&lt;font size=+2&gt;Daily Distractions&lt;/font&gt;&lt;/u&gt;&lt;/b&gt;&lt;/TD&gt;
&lt;/TR&gt;

&lt;!-- Add an image for some decoration --&gt;
&lt;TR&gt;
&lt;TD&gt;&lt;IMG SRC="images/jelly.jpg" HEIGHT=130 WIDTH=100&gt;&lt;/TD&gt;

&lt;!-- =================================================================== --&gt;
&lt;!-- Display links, if there are any
&lt;!-- =================================================================== --&gt;
&lt;TD&gt;
	&AGENT:links;
&lt;/TD&gt;
&lt;/TR&gt;

&lt;TR&gt;
&lt;!-- Add column headers --&gt;
&lt;TD&gt; &lt;/TD&gt;
&lt;TD&gt;&lt;b&gt;&lt;u&gt;&lt;font size=+2&gt;Yahoo News&lt;/font&gt;&lt;/u&gt;&lt;/b&gt;&lt;/TD&gt;
&lt;/TR&gt;

&lt;TR&gt;
&lt;TD&gt; &lt;!  Blank cell&gt;

&lt;!-- =================================================================== --&gt;
&lt;!-- Display results of connection to Yahoo
&lt;!-- =================================================================== --&gt;
&lt;TD&gt;
	&AGENT:ynews;
&lt;/TD&gt;
&lt;/TR&gt;

&lt;/TABLE&gt;
&lt;p&gt;
&lt;hr&gt;
&lt;p&gt;
&lt;!-- =================================================================== --&gt;
&lt;!-- Add an edit button
&lt;!-- =================================================================== --&gt;

&lt;input type="submit" value="Edit"&gt; 
&lt;/form&gt;
&lt;footer&gt;

&lt;/BODY&gt;
&lt;/HTML&gt;

</PRE>
There are a three variables that have been defined in the AGENT namespace:
one is the fullname (or <A HREF=#setfn>fname</A>) variable, the next
is the <A HREF=#agentlinks>links</A> variable, and finally, there is the
<A HREF=#ynvar>ynews</A> variable. Variables defined in the
AGENT namespace are available to all pages that make up the agent. A detailed
description of the PIA tags used in home.xh is as follows.
<BR> 
<DL>
<DT>
<TT>&lt;header></TT></DT>

<DD>
This is an element that puts the standard agent header at the top of the
page. This includes the PIA logo, that lets you navigate back to the Agency
home page. This tag is part of the predefined pia-xhtml tagset. This means
it is available to any agent running within PIA.</DD>

<DD>
</DD>

<DT>
<TT>&amp;AGENT:fname;</TT></DT>

<DD>
The <tt>fname</tt> variable holds the current value of the name that is to appear
in the title for the page. This variable is substituted when home.xh is
interpreted.If no value has been given, it will print as <TT>&piaUSER;</TT></DD>

<DT>
<TT>&amp;AGENT:links;</TT></DT>

<DD>
The <tt>links</tt> variable is set to the list of URLs that have been selected by
the user. The current value of this variable is shown as an unordered list
of URLS. If no links have been selected, it prints <TT>No links selected yet</TT></DD>

<DT>
<TT>&amp;AGENT:ynews;</TT></DT>

<DD>
The <tt>ynews</tt> variable is set to the node list that returned by a
connection to the News link in the Yahoo home page.  This variable is
initialized to <tt>No news initialized</tt>.  When the Edit button is
selected, this will automatically connect to the Yahoo page.
</DD>


<DD>
<TT></TT></DD>

<DT>
<TT>&lt;footer></TT></DT>

<DD>
This element is similar to <TT>&lt;header></TT> and also a member of the
pia-xhtml tagset. It provides the navigation bar at the bottom of the screen,
along with a copyright notice. If you wanted to create your own footer,
you would add it to a file in the Swifty directory called Swifty-xhmtl.ts
and define the footer element there. Look at the Camera agent for an example
of a different footer.</DD>
</DL>

<H4>
Creating the Editing Page</H4>
The second file associated with Swifty is edit_page.xh. This is the page
that presents you with editing capabilities and processes all user inputs.
When the Submit button is selected, it sets the AGENT namespace variables
associated with each form input. In order to see the effect of these edits
in the home page, you need to select the Swifty link in the top right corner
of the page. edit_page.xh is shown below, followed by a detailed description
of the input processing.
<PRE>&lt;!doctype html public "-//IETF//DTD HTML//EN//2.0">

&lt;html>&lt;head>
&lt;body bgcolor="#ffffff" link="#c40026" vlink="#e40026">
&lt;title>Home Page Editor&lt;/title>
&lt;a name="Swifty Edit">&lt;/a>
&lt;header>
&lt;/head>

&lt;!-- Process form variables -->

&lt;if>&lt;get name="FORM:submission"> &lt;then>

        &lt;if>&amp;FORM:fullname;&lt;then>
              <A NAME="setfn">&lt;set name="AGENT:fname"&gt;&amp;FORM:fullname;&lt;/set&gt;</A>         
        &lt;/if&gt;       
               &lt;!-- Process links selections --&gt; 
               <A NAME="agentlinks">&lt;set name=AGENT:links&gt;</A>
                  &lt;appendlink&gt;
               &lt;/set&gt;

	&lt;!-- Connect to Yahoo news --&gt;

	<A NAME="ynvar">&lt;set name=AGENT:ynews&gt;</A>
		&lt;connectto url="http://www.yahoo.com" link=News&gt;&lt;/connectto&gt;
	&lt;/set&gt;

&lt;/if&gt;

&lt;form action="/Swifty/edit_page" method="POST"&gt;

&lt;H2&gt;
Edit Your Home Page&lt;/H2&gt;
Enter a new or different name for your home page title, or select different
links.&lt;p&gt;
</PRE>

<PRE>Enter the name that will appear in the title of your home
page. 
&lt;p&gt; &lt;b&gt;Title name:&lt;/b&gt; &lt;input name="fullname" value="&amp;AGENT:fname;"&gt;
&lt;p&gt; &lt;HR&gt; &lt;p&gt; 

&lt;h2&gt; Select Links for Home Page &lt;/h2&gt; 

&lt;inputtype="checkbox" name="wea" value="Weather"&gt;Weather 
&lt;input type="checkbox"name="sjmn" value="San Jose Mercury News"&gt;San Jose Mercury News 
&lt;inputtype="checkbox" name="yah" value="Yahoo"&gt;Yahoo 
&lt;input type="checkbox"name="dej" value="DejaNews"&gt;DejaNews 
&lt;input type="checkbox" name="his"value="History"&gt;History &lt;p&gt; &lt;HR&gt; 
&lt;input type="submit" name="submission"value="Submit"&gt; 
&lt;input type="reset" value="Reset"&gt; &lt;/form&gt; 
&lt;footer&gt;
&lt;/body&gt;&lt;/html&gt;
</PRE>

<DL>
<DT>
Processing logic</DT>

<DD>
The main processing logic for edit_page.xh is contained in the <TT>if</TT>
clause. If the page is being displayed as a result of a submit from the
home page (that is, the home page's edit button has been selected), then
set the two variables <TT>&amp;AGENT:fname</TT> and <TT>&amp;AGENT:links</TT>
to the values already entered by the user. Next, display the page with
Title name field showing its current value. These items in the <TT>if</TT>
clause deserve closer scrutiny.</DD>
<ul>

<li><PRE>        &lt;if>&amp;FORM:fullname;&lt;then>
                &lt;set name="AGENT:fname">&amp;FORM:fullname;&lt;/set>
        &lt;/if></PRE>
This is where the fname variable is set within the AGENT namespace.
</li>

<li><PRE>        &lt;set name=AGENT:links>
                &lt;appendlink>
        &lt;/set></PRE>
Here, the links variable is being set to <TT>&lt;appendlink&gt;</TT>
which is a special tag that is defined in Swifty-xhtml.ts.</TT>
</li>

<li>
<pre>
	&lt;set name=AGENT:ynews&gt;
		&lt;connectto url="http://www.yahoo.com" link=News&gt;&lt;/connectto&gt;
	&lt;/set&gt;

</pre>
The <tt>AGENT:ynews</tt> variable is being set to the News link in the Yahoo home page
using the <a href="#conto"><tt>connectto</tt></a> tag.

</li>


<li><PRE><TT>&lt;b>Title name:&lt;/b> &lt;input name="fullname" value="&amp;AGENT:fname;"&gt;</TT></PRE>
This sets the value in the Title name text field to the current value
of &amp;AGENT:fname; so that it is shown in the field when the page is
displayed.
</li>

</ul>
</DL>

<H4>Agent Initialize File</H4>

In instances where you need to set some initial values for your agent,
you need to create an <tt>initialize.xh</tt> file.  This is the first
file that is loaded by PIA and is used to perform any kind of
initializations needed by the agent.  Its contents are not visible to
the end-user. It could be used to restore values saved to disk; for
Swifty, the <tt>initialize.xh</tt> file is used to set each of the
agent variables to reasonable initial values.  This file is as
follows:

<pre>

&lt;!doctype html system "html.dtd"&gt;
&lt;html&gt;&lt;head&gt;
&lt;title&gt;Initialize the &agentName; agent&lt;/title&gt;
&lt;/head&gt;&lt;body&gt;
&lt;h1&gt;Initialize the &agentName; agent&lt;/h1&gt;

&lt;user-message&gt;Initializing &agentName; from &filePath;&lt;/user-message&gt;

&lt;set name="AGENT:fname"&gt;&piaUSER;&lt;/set&gt;
&lt;set name="AGENT:links"&gt;No links selected yet&lt;/set&gt;
&lt;set name="AGENT:ynews"&gt;No news initialized&lt;/set&gt;

&lt;hr&gt;
&lt;b&gt;Copyright &copy; 1997 Ricoh Silicon Valley&lt;/b&gt;&lt;br&gt;
&lt;b&gt;$Id$&lt;/b&gt;&lt;br&gt;
&lt;/body&gt;&lt;/html&gt;

</pre>

The items of most interest are:
<ul>
<li> 
<pre>
&lt;user-message&gt;Initializing &agentName; from
&filePath;&lt;/user-message&gt; 
</pre> 

This writes a message to standard
output.  Use of the <a
href="/Agency/entities.if"><tt>&agentName;</tt></a> and 
<a href="/Agency/entities.if"><tt>&filePath;</tt></a> variables gives the
name of the Agent and the path for the <tt>initialize.xh</tt> file respectively.
</li>

<li>
<pre>
&lt;set name="AGENT:fname"&gt;&piaUSER;&lt;/set&gt;
</pre>
This sets an initial value for the title name to the username of the individual
running Swifty.  <a href="/Agency/entities.if"><tt>&piaUSER</tt></a> is a predefined PIA entity.
</li>

</ul>

<H4>
Agent Tagset</H4>
A tagset is needed when you want to do some special processing or provide
some capability that is not already provided in the PIA tagset. Creating
a tag is a way of encapsulating some kind of procedure or processing. 
Two of the tags defined in <a href="/Swifty/Swifty-xhtml.ts">Swifty-xhtml.ts</a> 
have one main purpose: to prevent adding duplicate links to the list that is 
displayed in the home page.  To do this, two tags have been defined. 
<ol>
<li><TT>&lt;checklink&gt;</TT> checks to see whether the URL passed in is already
on the list of links. If it is, it does nothing; if it is not already on
the list, that link is returned.</li>

<li><TT>&lt;appendlink&gt;</TT> checks the
value of each checkbox that was selected by the user. It then calls <TT>&lt;checklink&gt;</TT>
to see whether it is already on the list. If <TT>&lt;checklink&gt;</TT> returns a value,
<TT>&lt;appendlink&gt;</TT> does not add that value to the existing <TT>&amp;AGENT:links;</TT> list.
</li>
</ol>

The third tag, &lt;connectto&gt;, illustrates how to use the PIA basic tag
<a href="/PIA/Doc/Manuals/InterForm/Tagset/basic.html#Connect">&lt;connect&gt;</a>.

<H4>
Define the Checklink Element</H4>
What appear as tags in extended XML pages are defined as elements in a tagset.  An element
is a data structure similar to a C++ or Java class, in that it contains some data and performs
some sort of action.  The <TT>&lt;checklink&gt;</TT> element is defined as follows.
<PRE><TT>&lt;define element=checklink&gt;
        &lt;define attribute=link required&gt;&lt;/define&gt;
        &lt;doc&gt;
                Goes through the existing list of links and checks
                whether the attribute link is on the list.  If it is,
                that link is returned.
        &lt;/doc&gt;
        &lt;action&gt;
        &lt;select&gt;&amp;AGENT:links;&lt;content&gt;
                &lt;repeat list="&amp;selected;"&gt;
                        &lt;if&gt;&lt;test match=&amp;attributes:link;&gt;&amp;li;&lt;/test&gt;&lt;then&gt;
                                &amp;li;
                        &lt;/then&gt;
                        &lt;/if&gt;
        &lt;/repeat&gt;
        &lt;/select&gt;
        &lt;/action&gt;
&lt;/define&gt;</TT></PRE>

The first two lines define the tag and specify that it has a required
argument. 

<PRE><TT> 
&lt;define element=checklink&gt;
        &lt;define attribute=link required&gt;&lt;/define&gt;</TT></PRE>

In this case the argument, <TT>link</TT>, is the URL that is going to
be checked. The argument, or attribute value, passed into the element is set
to the <TT>attribute</TT> local variable. The text that appears between the <TT>doc</TT>
start and end tags is the documentation for this element. Processing for this
element is defined between the <TT>action</TT> start and end tags.</TT></PRE>

In the action code, the current contents of the global variable <TT>&amp;AGENT:links;</TT>
is selected. This means that the current list of links is captured in variable
<TT>&amp;selected;</TT>. Using the <TT>&lt;repeat&gt;</TT> tag, we iterate through the list
of links. At each iteration, we use the <TT>&lt;test&gt;</TT> tag to see whether the
list member <TT>&amp;li;</TT> for that iteration matches against the argument that
we passed in (which is available as local variable <TT>&amp;attributes:link;</TT>).
If there is a match, then we return the list member, otherwise do nothing.

<PRE><TT>        &lt;action&gt;
        &lt;select&gt;&amp;AGENT:links;&lt;content&gt;
                &lt;repeat list="&amp;selected;"&gt;
                        &lt;if&gt;&lt;test match=&amp;attributes:link;&gt;&amp;li;&lt;/test&gt;&lt;then&gt;
                                &amp;li;
                        &lt;/then&gt;
                        &lt;/if&gt;
        &lt;/repeat&gt;
        &lt;/select&gt;
        &lt;/action&gt;</TT></PRE>


<H4>
Define the Appendlink Element</H4>
<TT>&lt;appendlink&gt;</TT> checks user link selections to determine whether
it is appropriate to add them to the existing list of links. It is defined
as follows.
<PRE><TT>&lt;define element=appendlink&gt;
  &lt;doc&gt;
        If a link selection has been made and the link is not already on
        the list of links, add it.
  &lt;/doc&gt;                
  &lt;action&gt;
        &lt;set entity name=weaURL&gt;&lt;A HREF="http://www.nws.noaa.gov" TARGET=_blank&gt;Weather&lt;/A&gt;&lt;/set&gt;
        &lt;set entity name=sjmnURL&gt;&lt;A HREF="http://www.sjmercury.com" TARGET=_blank&gt;News&lt;/A&gt;&lt;/set&gt;
        &lt;set entity name=yahURL&gt;&lt;A HREF="http://www.yahoo.com" TARGET=_blank&gt;Yahoo&lt;/A&gt;&lt;/set&gt;
        &lt;set entity name=dejURL&gt;&lt;A HREF="http://www.dejanews.com" TARGET=_blank&gt;DejaNews&lt;/A&gt;&lt;/set&gt;
        &lt;set entity name=hisURL&gt;&lt;a href="/History"&gt;History&lt;/a&gt;&lt;/set&gt;

	&lt;ul&gt;
	&lt;select&gt;&AGENT:links; &lt;content&gt;&lt;/select&gt;
		&lt;if&gt;&FORM:wea;&lt;then&gt;
			&lt;if&gt;&lt;checklink link=&weaURL;&gt;&lt;/checklink&gt;
			&lt;else&gt;
				&lt;li&gt; &weaURL;
			&lt;/else&gt;&lt;/if&gt;
		
		&lt;/if&gt;
		&lt;if&gt;&FORM:sjmn;&lt;then&gt;
			&lt;if&gt;&lt;checklink link=&sjmnURL;&gt;&lt;/checklink&gt;
			&lt;else&gt;
				&lt;li&gt; &sjmnURL;
			&lt;/else&gt;&lt;/if&gt;
		&lt;/if&gt;
		&lt;if&gt;&FORM:yah;&lt;then&gt;
			&lt;if&gt;&lt;checklink link=&yahURL;&gt;&lt;/checklink&gt;
			&lt;else&gt;
				&lt;li&gt; &yahURL;
			&lt;/else&gt;&lt;/if&gt;
		&lt;/if&gt;
		&lt;if&gt;&FORM:dej;&lt;then&gt;
			&lt;if&gt;&lt;checklink link=&dejURL;&gt;&lt;/checklink&gt;
			&lt;else&gt;
				&lt;li&gt; &dejURL;
			&lt;/else&gt;&lt;/if&gt;
		&lt;/if&gt;
		&lt;if&gt;&FORM:his;&lt;then&gt;
			&lt;if&gt;&lt;checklink link=&hisURL;&gt;&lt;/checklink&gt;
			&lt;else&gt;
				&lt;li&gt; &hisURL;
			&lt;/else&gt;&lt;/if&gt;
		&lt;/if&gt;
	&lt;/ul&gt;
  &lt;/action&gt;
&lt;/define&gt;
</TT>
</PRE>
<TT>&lt;appendlink&gt;</TT> is self-contained, and consequently needs no arguments.
Looking at the code in more detail, the first few lines are creating an
entity name for each of the available links.
<PRE>
<TT>        &lt;set entity name=weaURL&gt;&lt;A HREF="http://www.nws.noaa.gov" TARGET=_blank&gt;Weather&lt;/A&gt;&lt;/set&gt;
        &lt;set entity name=sjmnURL&gt;&lt;A HREF="http://www.sjmercury.com" TARGET=_blank&gt;News&lt;/A&gt;&lt;/set&gt;
        &lt;set entity name=yahURL&gt;&lt;A HREF="http://www.yahoo.com" TARGET=_blank&gt;Yahoo&lt;/A&gt;&lt;/set&gt;
        &lt;set entity name=dejURL&gt;&lt;A HREF="http://www.dejanews.com" TARGET=_blank&gt;DejaNews&lt;/A&gt;&lt;/set&gt;
        &lt;set entity name=hisURL&gt;&lt;a href="/History"&gt;History&lt;/a&gt;&lt;/set&gt;</TT>
</PRE>
It is not necessary to do this, the only reason for it is to create a shorter
name for each of the URLs. As entities, they are automatically expanded
wherever they are used.

The code that is performing the most useful function is shown below. Like
<TT>&lt;checklink&gt;</TT> this is selecting the contents of <TT>&amp;AGENT:links;</TT>
as the selected set of links. Note that the contents of <TT>&amp;AGENT:links;</TT> is being expanded
within an <TT>&lt;ul&gt;</TT> environment. Then, for each checkbox button on the agent
editing page, it checks to see whether it has been selected. If so, it
calls <TT>&lt;checklink&gt;</TT> to see if it is already on the list. If <TT>&lt;checklink&gt;</TT>
returns that link, nothing further needs to be done. If the link is not
already on the list, a <TT>&lt;li&gt;</TT> list item is created for that link and it
is added to the unordered list of links. Each checkbox is checked in exactly
the same manner.

<PRE><TT>        &lt;ul&gt;
        &lt;select&gt;&amp;AGENT:links; &lt;content&gt;&lt;/select&gt;
                &lt;if&gt;&amp;FORM:wea;&lt;then&gt;
                        &lt;if&gt;&lt;checklink link=&amp;weaURL;&gt;&lt;/checklink&gt;
                        &lt;else&gt;
                                &lt;li&gt; &amp;weaURL;
                        &lt;/else&gt;&lt;/if&gt;
                
                &lt;/if&gt;
                                ...</TT></PRE>

<a name="conto"><H4>Define the Connecto Element</H4></a>

The &lt;connectto&gt; element makes a connection to a given URL and displays a link from
within the page returned for that URL.  This element was defined mainly to give
an example of the kinds of things you can do with the 
<a href="/PIA/Doc/Manuals/InterForm/Tagset/basic.html#Connect"><tt>&lt;connect&gt;</tt></a> tag.
The element definition is shown below.

<pre>

&lt;define element=connectto&gt;
	&lt;define attribute=url required&gt;&lt;/define&gt;
	&lt;define attribute=link required&gt;&lt;/define&gt;
	&lt;doc&gt;
		Connects to a url and displays the link from that
		url specified by link; for example, the News link
		in the yahoo url.  Only displays links that have absolute
		urls.  Links are displayed as unordered lists.
	&lt;/doc&gt;
	&lt;action&gt;
		&lt;set entity name=doc&gt;&lt;connect src=&attributes:url; result=content /&gt;&lt;/set&gt;
		&lt;set entity name=selanchors&gt;&lt;select&gt;&lt;from&gt;&doc;&lt;content&gt;&lt;/from&gt;&lt;name recursive&gt;a&lt;/name&gt;&lt;/select&gt;&lt;/set&gt;

		&lt;ul&gt;
		&lt;repeat&gt;&lt;foreach entity=x&gt;&selanchors;&lt;/foreach&gt;
			&lt;if&gt;&lt;test match=&attributes:link;&gt;&x;&lt;/test&gt;&lt;then&gt;
				&lt;set entity name=sresult&gt;&lt;text split&gt;&x;&lt;/text&gt;&lt;/set&gt;
					&lt;repeat&gt;&lt;foreach entity=i&gt;&sresult;&lt;/foreach&gt;
						&lt;if&gt;&lt;test match="http"&gt;&i;&lt;/test&gt;&lt;then&gt;
							&lt;li&gt; &x;
						&lt;/then&gt;
						&lt;/if&gt;
					&lt;/repeat&gt;
				&lt;/set&gt;
			&lt;/then&gt;
			&lt;/if&gt;
		&lt;/repeat&gt;
		&lt;/ul&gt;
	&lt;/action&gt;
&lt;/define&gt;

</pre>

Here is a more detailed look at what is happening in this element.
Two attributes are required: the url you are going to connect to, and
a word that appears in a link within that page.
<ul>
<li>
First, a connection is made to the named url, which is set to the local variable <tt>doc</tt>.
(At this point, you could simply return the entire page with <tt>&doc;</tt>.)  
<pre>
&lt;set entity name=doc&gt;&lt;connect src=&attributes:url; result=content /&gt;&lt;/set&gt;
</pre>

<li>
Next, a recursive select is done to retrieve all nodes that are anchors within the page.  
The list of anchors is captured in the local variable <tt>selanchors</tt>.
<pre>
&lt;set entity name=selanchors&gt;&lt;select&gt;&lt;from&gt;&doc;&lt;content&gt;&lt;/from&gt;&lt;name recursive&gt;a&lt;/name&gt;&lt;/select&gt;&lt;/set&gt;
</pre>
</li>

<li>
The main processing loop iterates through the list of anchors from
Yahoo, testing each one to see whether its text matches the <tt>link</tt>
attribute that was passed into the element.  There will be a match if
the <tt>link</tt> attribute string appears anywhere inside the anchor.  

If there is a match, a second test is made to determine whether this link
has an absolute url.  If it does, it is returned as an unordered
list item.  If the link does not have an absolute path, then it would
need to be put together from the <tt>&attributes:url;</tt> variable
and the <tt>&attributes:link;</tt> variable.  It is probably easier to
write a comprehensive URL path handler in Java than to try to do this
using primitive tags.

<pre>
	&lt;ul&gt;
	&lt;repeat&gt;&lt;foreach entity=x&gt;&selanchors;&lt;/foreach&gt;
		&lt;if&gt;&lt;test match=&attributes:link;&gt;&x;&lt;/test&gt;&lt;then&gt;
			&lt;if&gt;&lt;test match="http"&gt;&x;&lt;/test&gt;&lt;then&gt;
				&lt;li&gt; &x;
			&lt;/then&gt;
			&lt;/if&gt;
		&lt;/then&gt;
		&lt;/if&gt;
		&lt;/repeat&gt;

	&lt;/ul&gt;
</pre>

</li>
</ul>


<H4>
Expanding Swifty</H4>
There is much room for improvement. For example, suppose you wanted to
create a real photo album, where you cycle through a different picture
every day? In this instance, you could create a <TT>&lt;displayphoto&gt;</TT> tag that
contains a list of seven gifs. It would be easy to cycle through them using
the PIA entity <a href="/Agency/entities.if"><TT>&lt;dayName&gt;</TT></a> tag.

<H4>
Agent Debugging</H4>
As with any code, agent code does not always work correctly the first
time. Here are some techniques for understanding what is happening within
your agent. 
<UL>
<li>Use the <TT>&amp;urlQuery</TT>; PIA tag to check the name/value pairs
that are being posted from one page to another. 
For example: fullname=Master+of+the+Universe&amp;wea=Weather&amp;submission=Submit
indicates these entries: fullname, Weather checkbox and Submit button.</li>

<li> Look at the HTML source that is generated, using View/Document Source in the
browser menu. This will give a good indication of where the code broke
down.</li>

<li> Put in print statements and expand variables inside tagset elements
to check whether they have been set correctly.
</li>
</ul>


<H3>
<A NAME="advanced"></A>Advanced topics</H3>

<DL>
<DT>
<TT><A HREF="http://jaguar.crc.ricoh.com:8888/Agency/START-UP.html">START-UP.html</A></TT></DT>

<DD>
On start-up, the agency looks in PIA_xxx/Agents/Agency/START-UP.html for
any agents that should be installed. You will probably want to copy and
modify this file to start your own agents.</DD>

<DT>
Examples</DT>

<DD>
For more examples of agent InterForms, look in the <A HREF="http://jaguar.crc.ricoh.com:8888/PIA/Agents/">existing
agent directories </A>. (NOTE: We still need to select the most appropriate
examples for learning.)</DD>

<DT>
InterForms</DT>

<DD>
See <A HREF="http://jaguar.crc.ricoh.com:8888/InterForm/demo.if">InterForm
demo page</A> for example uses of InterForm tags and the <A HREF="http://jaguar.crc.ricoh.com:8888/PIA/Doc/Manuals/InterForm/">InterForm
manual</A> for detailed Interform usage and functions. In particular, note
that entity variables can be several levels deep. For example, <TT>&amp;AGENT.employees.1;</TT>
might return the first item in a list of employees associated with this
agent.</DD>

<DT>
Initialization</DT>

<DD>
An agents <TT>initialize.if</TT> InterForm is loaded and interpreted when
an agent starts up (if it exists)</DD>

<DT>
Inheritance</DT>

<DD>
Standard forms (like options.if) can be inherited from the Agents directory
(the agent will look in PIA_xxx/Agents if a form is not found in PIA_xxx/Agents/AGENT_NAME)</DD>

<DT>
Processing documents not specifically requested</DT>

<DD>
The agency allows an agent to process documents moving through the agency
even if they are not specifically directed at that agent. For example,
the History and CIA agents process all proxied documents. Each agent registers
a criteria for the documents it is interested in. Whenever the agency sees
a document (requests for documents are considered documents in their own
right), the agency gives the matching agent(s) a chance to process the
document before sending it on to its destination.</DD>
</DL>

<HR><B>Copyright &copy; 1997 Ricoh Silicon Valley</B>
<BR><B>$Id$</B>
</BODY>
</HTML>
