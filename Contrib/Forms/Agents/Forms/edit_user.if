<!doctype html public "-//IETF//DTD HTML//EN//2.0">
<html><head>
<title>&agentName; administration</title>
<link rev="made" href="mailto:wolff@crc.ricoh.com"></link>
</head><body>
<set entity name=title> Editing <get form name=euser></set>
<read interform file="heading.inc" process>

<tagset-load name=Form-agent-actors>

 <if-in-group  group=admin> <set name=allow> true</set> </if-in-group>
 <if> <test match=&FORM.euser; exact><get trans name=AuthenticatedUser></test>
      <then><set name=allow> true</set> </then></if>

 <if> <get form name=euser>
 <then>
   <set name=euser> <get  form name=euser></set>
   <set name=uid> <get  form name=euser></set>
   <set name=alistid><user-info user=&euser; attribute=authlistid></set>
   
   <form action="&url;" id="euser1"  copy method=post>
   <input name="euser" type=hidden  value="&euser;">
   <input name="alistid" type=hidden  value="&alistid;">
   <process copy>
   
   <if><get name=allow>
     <then>
       <set name=u><get agent name=users key=&uid;></set>
       <set index=u.username replace><get name=username form></set>
       <set index=u.userext replace><get name=userext form></set>

	   <!-- Saving new data to disk -->
	   <save-data data=users>

   </then> <else>
   <h2>NOT Authorized</h2>
   Users not in the admin group can only change entries for themselves.
  </else></if>
		    <br>
 </process>

 <set name=u><get agent name=users key=&uid;></set>

 <table>
<TR><TD>user-id: <TD><get name=uid>
<TR><TD> Full name:<TD><input name="username" size="30" value=&u.username.Text;>
<TR> <a href=show_auth_list.if>Manager:</a><TD><manager user=&uid><TD>Manager:<TD><select name=manager></TD></TR>
  <TR> <TD>Phone:<TD><input name="userext" size="7" value=&u.userext.Text;>
</table>


  <br>
  <input type="SUBMIT" value="Submit">  
 </form>
<h4> Authorized signers for &uid;</h4>
 <get agent name=cachedroutes key=&uid;>
 <p>
   <set name=myuser><get name=users agent key=&uid;></set>
   <if> <get index=myuser.userpublickey.Text> <then> </then>
   <else>
   This user does not have a public key, and should <a href="register.if">create a
   key</a> before digitally signing forms.
 </else></if>

 </then>
</if>

<if-in-group  group=admin>  
<hr>
<form action="&url;">
 Select userid to edit:
 <select name="euser">
  <option> <get trans name=AuthenticatedUser></option>
 <repeat list=&AGENT.users.keys;> <option>&li;</option></repeat>
 </select>
<input type="SUBMIT" value="Edit">
</form>

   <hr>
<form action="&url;" method=post copy id="deluser1">
   <process copy>
   <set name=duser> <get form name=deluser></set>
   <set name=u><get agent name=users key=&duser;></set>
   <set agent name=users key=&duser; delete></set>
<!-- TBD delete from authlist -->
    <b>  Deleted &duser; </b><br>
    <save-data data=users>

  </process>
 Delete userid:
  
 <select name="deluser">
    <if> <get form name=euser>
 <then><option><get form name=euser></option></then></if>
 <repeat list=&AGENT.users.keys;> <option>&li;</option></repeat>
 </select>
<input type="SUBMIT" value="DELETE USERID">
</form>
</if-in-group>

<hr>
 
<expand><get agent name=navbar></expand>
<b>Copyright © 1998 Ricoh Silicon Valley</b><br>
<!-- $Id$ -->
<!-- hhmts start -->
Last modified: Wed Aug 12 12:07:16 1998
<!-- hhmts end -->
</body></html>
