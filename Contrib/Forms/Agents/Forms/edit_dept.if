<!doctype html public "-//IETF//DTD HTML//EN//2.0">
<html><head>
<title>&agentName; administration</title>
<link rev="made" href="mailto:wolff@crc.ricoh.com"></link>
</head><body>
<set entity name=title> Editing Department <get form name=dept></set>
<read interform file="heading.inc" process>

<tagset-load name=Form-agent-actors>

 <if-in-group  group=admin> <set name=allow> true</set> </if-in-group>
 <set name=dadmin><dept-get-admin dept=&FORM.dept;></set>
<!-- deptadmin can be a user or a group -->
 <if-in-group  group=&dadmin;> <set name=allow> true</set> </if-in-group>
 <if> <test match=&dadmin; exact><get trans name=AuthenticatedUser></test>
      <then><set name=allow> true</set> </then></if>

 <if> <get form name=dept>
 <then>
 <set name=dept> <get  form name=dept></set>
<form action="&url;" id="editdept"  copy method=post>
<input name="dept" type=hidden  value="&dept;">
 <process copy>

   <if><get name=allow>  <then>
   <dept-set-description department=&dept;><get name=description form></dept-set-description>
   <dept-set-manager manager=&FORM.manager; department=&dept;>
   <dept-set-secondmanager manager=&FORM.secondmanager; department=&dept;>
   <dept-set-admin admin=&FORM.admin; department=&dept;>

		    <!-- Saving new data to disk -->
		    <save-data data=departments>

   </then> <else>
   <h2>NOT Authorized</h2>
   Only <get name=dadmin> and admin users are authorized to change entries.
  </else></if>
		    <br>
 </process>

 
 <set name=d><get agent name=departments key=&dept;></set>

 <table>

<TR><TD>Department: <TD><get index=d.deptnumber> </TR>
<TR><TD> Description:<TD><input name="description" size="30" value=&d.deptdesc.Text;>
<TR><TD> Manager:<TD><select name="manager">
 <option><dept-get-manager department=&dept;></option>
 <repeat list=&AGENT.users.keys;> <option><get name=li></option></repeat>
</select>
<TR><TD> 2nd Level Manager:<TD><select name="secondmanager">
 <option><dept-get-secondmanager department=&dept;></option>
 <repeat list=&AGENT.users.keys;> <option><get name=li></option></repeat>
</select>
<TR> <TD>Administrator:<TD><select name="admin">
 <option><dept-get-admin department=&dept;></option>
 <repeat list=&AGENT.users.keys;> <option><get name=li></option></repeat>
 <repeat list=&AGENT.groups.keys;> <option><get name=li></option></repeat>
</select></TR>
<TR><TD>Members: <br>
(Click on a member name to change their department) </TD>
<td> <dept-get-members department=&d.deptnumber.Text;> 
 </TR>
</table>
  <input type="SUBMIT" value="Save Department Changes">  
 </form>

 </then>
</if>

<if-in-group  group=admin>  
<hr>
<form action="&url;">
 Select department to edit:
 <select name="dept">
 <repeat list=&AGENT.departments.keys;> <option>&li;</option></repeat>
 </select>
<input type="SUBMIT" value="Edit">
</form>


</if-in-group>

<hr>
 
<expand><get agent name=navbar></expand>
<b>Copyright © 1998 Ricoh Silicon Valley</b><br>
<!-- $Id$ -->
<!-- hhmts start -->
Last modified: Tue Feb 17 14:03:52 1998
<!-- hhmts end -->
</body></html>
